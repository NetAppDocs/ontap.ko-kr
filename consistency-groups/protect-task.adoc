---
permalink: consistency-groups/protect-task.html 
sidebar: sidebar 
keywords: application protection, two-phase commit, 2 phase, smbc, async snapmirror, local, remote, snapshot 
summary: '로컬 스냅샷, SM-BC(SnapMirror Business Continuity) 또는 비동기식 SnapMirror 보호를 사용하여 일관성 그룹을 보호합니다.' 
---
= 일관성 그룹 보호
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
일관성 그룹은 여러 볼륨에 걸쳐 있는 SAN, NAS 및 NVMe 애플리케이션에 대해 쉽게 관리되는 로컬 및 원격 보호를 제공합니다.

일관성 그룹을 생성해도 보호가 자동으로 설정되지는 않습니다. 보호 정책은 생성 시 또는 일관성 그룹을 생성한 후에 설정할 수 있습니다. 다음을 사용하여 일관성 그룹을 보호할 수 있습니다.

* 로컬 스냅샷 정책
* SnapMirror 비즈니스 연속성(SM-BC)
* 비동기식 SnapMirror(9.13.1 시작)


중첩된 일관성 그룹을 사용하는 경우 상위 및 하위 일관성 그룹에 대해 서로 다른 보호 정책을 설정할 수 있습니다.

ONTAP 9.11.1부터 정합성 보장 그룹이 제공됩니다 <<two-phase,2단계 일관성 그룹 스냅샷 생성>>. 2단계 스냅샷은 사전 점검을 실행하여 스냅샷이 성공적으로 캡처되도록 합니다.

전체 정합성 보장 그룹, 계층적 구성의 단일 정합성 보장 그룹 또는 정합성 보장 그룹 내의 개별 볼륨에 대해 복구가 수행될 수 있습니다. 복구할 정합성 보장 그룹을 선택하고 스냅샷 복사본 유형을 선택한 다음 복구를 기반으로 할 스냅샷 복사본을 식별하여 복구를 수행할 수 있습니다. 이 프로세스에 대한 자세한 내용은 을 참조하십시오 link:../task_dp_restore_from_vault.html["이전 스냅샷 복사본에서 볼륨을 복원합니다"].



== 로컬 스냅샷 보호 정책을 설정합니다

로컬 스냅샷 보호 정책을 설정하면 정합성 보장 그룹의 모든 볼륨을 포괄하는 정책을 생성할 수 있습니다.

.이 작업에 대해
스냅샷 복사본 일정의 최소 값은 30분을 유지하는 것이 좋습니다.  이 권장 사항은 을 기반으로 합니다 link:https://www.netapp.com/media/12385-tr4571.pdf["FlexGroups 테스트"^]정합성 보장 그룹과 동일한 Snapshot 인프라를 공유합니다.

.단계
. 스토리지 > 정합성 보장 그룹 * 을 선택합니다.
. 정합성 보장 그룹 메뉴에서 생성한 정합성 보장 그룹을 선택합니다.
. 일관성 그룹의 개요 페이지 오른쪽 위에서 * 편집 * 을 선택합니다.
. 스냅샷 복사본 예약(로컬) * 옆의 확인란을 선택합니다.
. 스냅샷 정책을 선택합니다. 새 사용자 지정 정책을 구성하려면 을 참조하십시오 link:../task_dp_create_custom_data_protection_policies.html["사용자 지정 데이터 보호 정책을 생성합니다"].
. 저장 * 을 선택합니다.
. 일관성 그룹 개요 메뉴로 돌아갑니다. Snapshot 복사본(로컬) * 의 왼쪽 열에서 옆에 보호됨 상태가 표시됩니다 image:../media/icon_shield.png["Alt = 녹색 차폐 아이콘"].




== 2단계 정합성 보장 그룹 스냅샷을 생성합니다

ONTAP 9.11.1부터 일관성 그룹은 일관성 그룹(CG) 스냅샷 생성을 위한 2단계 커밋을 지원하며, 이 일관성 그룹은 스냅샷을 커밋하기 전에 사전 검사를 실행합니다. 이 기능은 ONTAP REST API에서만 사용할 수 있습니다.

2단계 CG 스냅샷 생성은 스냅샷 생성에만 사용할 수 있고 일관성 그룹을 프로비저닝하거나 일관성 그룹을 복원하는 경우에는 사용할 수 없습니다.

2단계 CG 스냅샷 생성은 에 대한 POST 요청과 함께 호출된 스냅샷 생성 프로세스를 중단시킵니다 `/application/consistency-groups/{consistency_group_uuid}/snapshots` 두 개의 위상 시퀀스로 끝점:

. POST 요청으로 시작된 첫 번째 단계에서는 API가 사전 점검을 수행하고 스냅샷 생성을 트리거하며 지정된 간격에 대한 타이머를 시작합니다.
. 1단계의 POST 요청이 201 상태 코드로 완료되면 첫 번째 단계에서 지정된 간격 내에 두 번째 단계를 호출하여 스냅샷을 해당 끝점에 커밋할 수 있습니다.


ONTAP REST API에 대한 자세한 내용은 를 참조하십시오 link:https://docs.netapp.com/us-en/ontap-automation/reference/api_reference.html["API 참조입니다"^] 또는 를 방문하십시오 link:https://devnet.netapp.com/restapi.php["ONTAP REST API 페이지입니다"^] API 엔드포인트의 전체 목록을 보려면 NetApp Developer Network 를 참조하십시오.

.시작하기 전에
* 2단계 CG 스냅샷 생성을 사용하려면 클러스터의 모든 노드에서 ONTAP 9.11.1 이상을 실행해야 합니다.
* 일관성 그룹 스냅샷 생성 작업의 활성 호출은 한 번에 한 단계이든 두 단계이든 일관성 그룹 인스턴스에서 지원됩니다. 다른 스냅샷이 진행 중인 동안 스냅샷 생성을 호출하면 오류가 발생합니다.
* 2단계 정합성 보장 그룹 스냅샷 생성은 를 사용하여 호출할 수 있습니다 `action=start` 매개 변수.
+
또한 를 사용할 수 있습니다 `action_timeout` 매개 변수를 사용하여 스냅샷 생성 프로세스에 소요될 수 있는 최대 시간(초)을 지정합니다. 를 클릭합니다 `action_timeout` 매개 변수는 5에서 120 사이의 정수로 설정할 수 있습니다. 의 기본값입니다 `action_timeout` 7입니다.



.단계
. 스냅샷 생성을 호출합니다. 을 사용하여 일관성 그룹 끝점에 POST 요청을 보냅니다 `action=start` 매개 변수.
+
[source, curl]
----
curl -k -X POST 'https://<IP_address>/application/consistency-groups/<cg-uuid>/snapshots?action=start&action_timeout=7' -H "accept: application/hal+json" -H "content-type: application/json" -d '
{
  "name": "<snapshot_name>",
  "consistency_type": "crash",
  "comment": "<comment>",
  "snapmirror_label": "<SnapMirror_label>"
}'
----
. POST 요청이 성공하면 출력에 스냅샷 uuid가 포함됩니다. 해당 uuid를 사용하여 스냅샷을 커밋하기 위한 패치 요청을 제출합니다.
+
[source, curl]
----
curl -k -X PATCH 'https://<IP_address>/application/consistency-groups/<cg_uuid>/snapshots/<snapshot_id>?action=commit' -H "accept: application/hal+json" -H "content-type: application/json"
----




== 정합성 보장 그룹에 대한 원격 보호를 설정합니다

정합성 보장 그룹은 SM-BC를 통해 원격 보호를 제공하며, ONTAP 9.13.1 비동기 SnapMirror부터 시작합니다.



=== SM-BC를 사용하여 보호 구성

SM-BC를 활용하여 일관성 그룹에 생성된 일관성 그룹의 스냅샷 복사본이 타겟으로 복제되도록 할 수 있습니다. SM-BC에 대한 자세한 내용은 을 참조하십시오 xref:../task_san_configure_protection_for_business_continuity.html[무중단 업무 운영을 위한 보호 구성].

.시작하기 전에
* NAS 액세스를 위해 마운트된 볼륨에 SM-BC 관계를 설정할 수 없습니다.
* 소스 및 대상 클러스터의 정책 레이블이 일치해야 합니다.
* SnapMirror 레이블이 지정된 규칙이 미리 정의된 에 추가되지 않으면 SM-BC에서 기본적으로 스냅샷 복사본을 복제하지 않습니다 `AutomatedFailOver` 정책 및 스냅샷 복사본이 해당 레이블로 생성됩니다.
+
이 프로세스에 대한 자세한 내용은 을 참조하십시오 link:../task_san_configure_protection_for_business_continuity.html["무중단 업무 운영을 위한 보호 구성"].

* ONTAP 9.13.1 부터는 무중단으로 업그레이드할 수 있습니다 xref:modify-task.html#add-volumes-to-a-consistency-group[볼륨을 일관성 그룹에 추가합니다] SM-BC 관계가 활성화된 경우 정합성 보장 그룹에 대한 다른 변경 사항은 SM-BC 관계를 끊은 후 정합성 보장 그룹을 수정한 다음 관계를 다시 설정하고 재동기화해야 합니다.


.단계
. 을(를) 충족하는지 확인합니다 link:../smbc/smbc_plan_prerequisites.html["SM-BC 사용을 위한 사전 요구 사항"].
. 스토리지 > 정합성 보장 그룹 * 을 선택합니다.
. 정합성 보장 그룹 메뉴에서 생성한 정합성 보장 그룹을 선택합니다.
. 개요 페이지 오른쪽 상단에서 * 자세히 * 를 선택한 다음 * 보호 * 를 선택합니다.
. System Manager는 소스 측 정보를 자동으로 채웁니다. 대상에 적합한 클러스터 및 스토리지 VM을 선택합니다. 보호 정책을 선택합니다. Initialize relationship * 이 선택되어 있는지 확인합니다.
. 저장 * 을 선택합니다.
. 정합성 보장 그룹을 초기화하고 동기화해야 합니다. 정합성 보장 그룹 * 메뉴로 돌아가 동기화가 성공적으로 완료되었는지 확인합니다. SnapMirror(원격) * 상태가 표시됩니다 `Protected` 옆에 있습니다 image:../media/icon_shield.png["Alt = 녹색 차폐 아이콘"].




=== 비동기식 SnapMirror 보호를 구성합니다

ONTAP 9.13.1 부터는 단일 일관성 그룹에 대해 비동기식 SnapMirror 보호 기능을 구성할 수 있습니다.

.시작하기 전에
* 비동기식 SnapMirror 보호 기능은 단일 일관성 그룹에서만 사용할 수 있습니다. 계층적 일관성 그룹에는 지원되지 않습니다. 계층적 일관성 그룹을 단일 일관성 그룹으로 변환하려면 을 참조하십시오 xref:modify-geometry-task.html[정합성 보장 그룹 아키텍처 수정].
* xref:../data-protection/supported-deployment-config-concept.html[다중 구간 구축] SM-BC에서는 지원되지 않습니다.
* 소스 및 대상 클러스터의 정책 레이블이 일치해야 합니다.
* 무중단으로 확장 가능합니다 xref:modify-task.html#add-volumes-to-a-consistency-group[볼륨을 일관성 그룹에 추가합니다] 지원할 수 있습니다. 일관성 그룹이 변경되면 SnapMirror 관계를 중단시키고 일관성 그룹을 수정한 다음, 관계를 다시 설정하고 다시 동기화해야 합니다.
* 여러 개별 볼륨에 대해 비동기식 SnapMirror 보호 관계를 구성한 경우 기존 스냅샷을 유지하면서 해당 볼륨을 일관성 그룹으로 변환할 수 있습니다. 볼륨을 성공적으로 변환하려면 다음을 수행합니다.
* 볼륨의 공통 스냅샷 복사본이 있어야 합니다.
* 기존 SnapMirror 관계를 해제해야 합니다. xref:configure-task.html[단일 일관성 그룹에 볼륨을 추가합니다]그런 다음 다음 다음 다음 워크플로를 사용하여 관계를 다시 동기화합니다.


.단계
. 대상 클러스터에서 * 스토리지 > 일관성 그룹 * 을 선택합니다.
. 정합성 보장 그룹 메뉴에서 생성한 정합성 보장 그룹을 선택합니다.
. 개요 페이지 오른쪽 상단에서 * 자세히 * 를 선택한 다음 * 보호 * 를 선택합니다.
. System Manager는 소스 측 정보를 자동으로 채웁니다. 대상에 적합한 클러스터 및 스토리지 VM을 선택합니다. 보호 정책을 선택합니다. Initialize relationship * 이 선택되어 있는지 확인합니다.
+
비동기 정책을 선택할 때 ** 전송 일정 재정의** 옵션을 사용할 수 있습니다.

+
[NOTE]
====
비동기식 SnapMirror를 사용하는 일관성 그룹에 대해 지원되는 최소 일정(복구 지점 목표 또는 RPO)은 30분입니다.

====
. 저장 * 을 선택합니다.
. 정합성 보장 그룹을 초기화하고 동기화해야 합니다. 정합성 보장 그룹 * 메뉴로 돌아가 동기화가 성공적으로 완료되었는지 확인합니다. SnapMirror(원격) * 상태가 표시됩니다 `Protected` 옆에 있습니다 image:../media/icon_shield.png["Alt = 녹색 차폐 아이콘"].




== 관계를 시각화합니다

System Manager는 * Protection > Relationships * 메뉴에서 LUN 맵을 시각화합니다. 소스 관계를 선택하면 System Manager에서 소스 관계를 시각화합니다. 볼륨을 선택하면 이러한 관계를 자세히 살펴보고 포함된 LUN 및 이니시에이터 그룹 관계의 목록을 볼 수 있습니다. 이 정보는 개별 볼륨 보기에서 Excel 통합 문서로 다운로드할 수 있습니다. 다운로드 작업은 백그라운드에서 실행됩니다.

.관련 정보
* link:clone-task.html["일관성 그룹의 클론을 생성합니다"]
* link:../task_dp_configure_snapshot.html["스냅샷 복사본을 구성합니다"]
* link:../task_dp_create_custom_data_protection_policies.html["사용자 지정 데이터 보호 정책을 생성합니다"]
* link:../task_dp_recover_snapshot.html["Snapshot 복사본에서 복구"]
* link:../task_dp_restore_from_vault.html["이전 스냅샷 복사본에서 볼륨을 복원합니다"]
* link:../smbc/index.html["SM-BC 개요"]
* link:https://docs.netapp.com/us-en/ontap-automation/["ONTAP 자동화 문서"^]
* xref:../data-protection/snapmirror-disaster-recovery-concept.html[비동기식 SnapMirror 재해 복구 기본 사항]

