---
sidebar: sidebar 
permalink: snapmirror-active-sync/architecture-concept.html 
keywords: SM-BC, SMBC, snapmirror active sync 
summary: 애플리케이션 보호를 올바르게 구성하기 위한 SnapMirror 활성 동기화의 아키텍처를 이해해야 합니다. 
---
= ONTAP SnapMirror 액티브 싱크 아키텍처
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
SnapMirror Active Sync 아키텍처는 두 클러스터 모두에서 활성 워크로드를 지원하여 두 클러스터 모두에서 운영 워크로드를 동시에 처리할 수 있습니다. 일부 국가의 금융 기관을 위한 규정에 따라 기업은 SnapMirror 액티브 동기화가 지원되는 "Tick-Tock" 구축에서도 보조 데이터 센터에서 주기적으로 서비스를 받을 수 있어야 합니다.

비즈니스 연속성을 보호하기 위한 데이터 보호 관계는 스토리지 가상 머신(SVM) 내 여러 볼륨의 애플리케이션별 LUN 또는 NVMe 네임스페이스를 일관성 그룹에 추가하여 소스 스토리지 시스템과 대상 스토리지 시스템 간에 생성됩니다. 일반적인 운영 환경에서는 엔터프라이즈 애플리케이션이 기본 일관성 그룹에 데이터를 쓰고, 기본 일관성 그룹은 이 I/O를 미러 일관성 그룹에 동기적으로 복제합니다.

image:snapmirror-active-sync-architecture.png["SnapMirror Active 아키텍처"]

데이터 보호 관계에 두 개의 개별 데이터 사본이 존재하더라도 SnapMirror Active Sync는 동일한 LUN 또는 NVMe 네임스페이스 ID를 유지하므로 애플리케이션 호스트는 이를 여러 경로를 가진 공유 가상 장치로 인식하고, 한 번에 하나의 LUN 또는 NVMe 네임스페이스 사본에만 쓰기가 수행됩니다. 장애로 인해 기본 스토리지 시스템이 오프라인 상태가 되면 ONTAP 이 장애를 감지하고 Mediator를 사용하여 재확인합니다. ONTAP 과 Mediator 모두 기본 사이트에 ping을 보낼 수 없는 경우, ONTAP 자동 장애 조치(failover) 작업을 수행합니다. 이 프로세스를 통해 이전에는 장애 조치를 위해 필요했던 수동 개입이나 스크립팅 없이 특정 애플리케이션만 장애 조치할 수 있습니다.

기타 고려 사항:

* 비즈니스 연속성을 위한 보호 범위를 벗어나는 미러링되지 않은 볼륨이 지원됩니다.
* 비즈니스 연속성을 위해 보호되는 볼륨에 대해 하나의 다른 SnapMirror 비동기식 관계만 지원됩니다.
* Cascade 토폴로지는 무중단 업무 운영을 위한 보호 기능이 지원되지 않습니다.




== 중재자의 역할

SnapMirror Active Sync는 Mediator를 사용하여 SnapMirror Active Sync 복사본에 대한 수동 감시 역할을 합니다. 네트워크 파티션이 발생하거나 복사본 하나를 사용할 수 없는 경우, SnapMirror Active Sync는 Mediator를 사용하여 어떤 복사본이 I/O를 계속 처리할지 결정하고, 다른 복사본의 I/O는 중단합니다. 온프레미스 ONTAP Mediator 외에도 ONTAP 9.17.1부터 ONTAP Cloud Mediator를 설치하여 클라우드 배포 환경에서 동일한 기능을 제공할 수 있습니다. ONTAP Mediator 또는 ONTAP Cloud Mediator를 사용할 수 있지만, 동시에 사용할 수는 없습니다.

Mediator는 SnapMirror 액티브 동기화 구성에서 패시브 쿼럼 감시(passive quorum witness)로서 중요한 역할을 수행하여 쿼럼 유지 관리를 보장하고 장애 발생 시 데이터 액세스를 용이하게 합니다. 이는 컨트롤러가 피어 컨트롤러의 활성 상태를 확인하는 ping 프록시 역할을 합니다. Mediator는 스위치오버 작업을 직접 트리거하지는 않지만, 네트워크 통신 문제 발생 시 생존 노드가 파트너의 상태를 확인할 수 있도록 하는 중요한 기능을 제공합니다. ONTAP Mediator는 쿼럼 감시 역할을 수행하면서 피어 클러스터에 대한 대체 경로(실제로는 프록시 역할)를 제공합니다.

또한, 클러스터가 쿼럼 프로세스의 일부로 이 정보를 얻을 수 있도록 합니다. 통신 목적으로 노드 관리 LIF와 클러스터 관리 LIF를 사용합니다. 사이트 장애와 ISL(InterSwitch Link) 장애를 구분하기 위해 여러 경로를 통해 중복 연결을 설정합니다. 이벤트로 인해 클러스터가 Mediator 소프트웨어 및 모든 노드와의 연결이 끊어지면 연결할 수 없는 것으로 간주됩니다. 이 경우 경고가 발생하고 보조 사이트의 미러 일관성 그룹으로 자동 장애 조치가 활성화되어 클라이언트의 중단 없는 I/O가 보장됩니다. 복제 데이터 경로는 하트비트 메커니즘을 사용하며, 네트워크 오류나 이벤트가 일정 기간 이상 지속되면 하트비트 장애가 발생하여 관계가 동기화되지 않을 수 있습니다. 그러나 다른 포트로의 LIF 장애 조치와 같은 중복 경로가 있으면 하트비트를 유지하고 이러한 중단을 방지할 수 있습니다.

.ONTAP 중재자
ONTAP Mediator는 모니터링하는 두 개의 ONTAP 클러스터와는 별개의 세 번째 장애 도메인에 설치됩니다. 이 설정에는 세 가지 핵심 구성 요소가 있습니다.

* SnapMirror 활성 동기화 운영 정합성 보장 그룹을 호스팅하는 운영 ONTAP 클러스터입니다
* 미러 정합성 보장 그룹을 호스팅하는 보조 ONTAP 클러스터입니다
* ONTAP 중재자


ONTAP Mediator는 다음 목적으로 사용됩니다.

* 정족수를 설정한다
* 자동 페일오버(AUFO)를 통한 지속적인 가용성
* 계획된 페일오버(PFO)



NOTE: ONTAP Mediator 1.7은 비즈니스 연속성을 위해 10개의 클러스터 쌍을 관리할 수 있습니다.


NOTE: ONTAP Mediator를 사용할 수 없는 경우 계획된 장애 조치나 자동 장애 조치를 수행할 수 없습니다.  애플리케이션 데이터는 어떠한 중단 없이 동기적으로 복제되므로 데이터 손실이 없습니다.

.ONTAP 클라우드 중재자
ONTAP 9.17.1부터 ONTAP Cloud Mediator는 BlueXP 에서 SnapMirror 액티브 동기화와 함께 사용할 수 있는 클라우드 기반 서비스로 제공됩니다. ONTAP Mediator와 유사하게 ONTAP Cloud Mediator는 SnapMirror 액티브 동기화 관계에서 다음과 같은 기능을 제공합니다.

* HA 또는 SnapMirror 활성 동기화 메타데이터에 대한 지속적이고 보호된 저장소를 제공합니다.
* 컨트롤러 활성을 위한 핑 프록시 역할을 합니다.
* quorum 결정에 도움이 되는 동기 노드 상태 쿼리 기능을 제공합니다.


ONTAP Cloud Mediator는 BlueXP 클라우드 서비스를 관리할 필요가 없는 제3의 사이트로 활용하여 SnapMirror Active Sync 배포를 간소화합니다. ONTAP Cloud Mediator 서비스는 온프레미스 ONTAP Mediator와 동일한 기능을 제공하지만, 제3의 사이트 유지 관리에 따른 운영 복잡성을 줄여줍니다 . 반면, ONTAP Cloud Mediator는 패키지 형태로 제공되며, 운영을 위한 독립적인 전원 및 네트워크 인프라를 갖춘 제3의 사이트에서 실행되는 Linux 호스트에 설치해야 합니다.



== SnapMirror Active Sync 작업 워크플로

다음 그림에서는 개괄적인 SnapMirror 액티브 동기화의 설계를 보여 줍니다.

image:workflow_san_snapmirror_business_continuity.png["높은 수준의 SnapMirror 활성 동기화 설계"]

이 다이어그램은 운영 데이터 센터의 SVM(스토리지 VM)에서 호스팅되는 엔터프라이즈 애플리케이션을 보여 줍니다. SVM은 볼륨 5개를 포함하며, 볼륨 3개는 일관성 그룹의 일부입니다. 일관성 그룹의 볼륨 3개가 보조 데이터 센터에 미러링됩니다. 정상적인 상황에서는 모든 쓰기 작업이 운영 데이터 센터에 수행됩니다. 실제로 이 데이터 센터는 I/O 작업의 소스로 사용되고, 보조 데이터 센터는 대상으로 작동합니다.

1차 데이터 센터에서 재해가 발생하는 경우 ONTAP 2차 데이터 센터가 1차 데이터 센터 역할을 하도록 지시하여 모든 I/O 작업을 처리합니다.  일관성 그룹에 미러링된 볼륨만 제공됩니다.  SVM의 다른 두 권과 관련된 모든 작업은 재해 사건의 영향을 받습니다.



== 대칭적인 액티브/액티브

SnapMirror Active Sync는 비대칭 솔루션 및 대칭 솔루션을 제공합니다.

_비대칭 구성_에서 기본 스토리지 사본은 활성-최적화 경로를 노출하고 클라이언트 I/O를 능동적으로 처리합니다. 보조 사이트는 I/O에 원격 경로를 사용합니다. 보조 사이트의 스토리지 경로는 활성-비최적화로 간주됩니다. 쓰기 LUN에 대한 액세스는 보조 사이트에서 프록시됩니다. NVMe 프로토콜은 비대칭 구성에서 지원되지 않습니다.

_대칭 액티브/액티브 구성_에서는 액티브 최적화 경로가 양쪽 사이트에 모두 노출되고, 호스트별로 구성 가능하며, 구성 가능합니다. 즉, 양쪽 호스트가 액티브 I/O를 위해 로컬 스토리지에 액세스할 수 있습니다. ONTAP 9.16.1부터 대칭 액티브/액티브 구성은 최대 4개의 노드로 구성된 클러스터에서 지원됩니다. ONTAP 9.17.1부터 대칭 액티브/액티브 구성은 2노드 클러스터에서 NVMe 프로토콜을 지원합니다.

image:snapmirror-active-sync-symmetric.png["대칭 액티브 구성"]

대칭 액티브/액티브는 VMware Metro Storage Cluster, Oracle RAC, SQL을 사용한 Windows 페일오버 클러스터링을 비롯한 클러스터 애플리케이션을 대상으로 합니다.
